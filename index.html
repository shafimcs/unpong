<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Unpong</title>
  <link rel="stylesheet" href="style/style.css"/>
  <link href='http://fonts.googleapis.com/css?family=Julius+Sans+One' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,700' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
</head>
<body>
<div class="view-container grid-3">
  <div class="left" data-player="0">
    <header>
      <h1>Team Red</h1>
      <img src="img/johnny.jpg" alt=""/>
      <h2>Johnny "Cache"</h2>
    </header>
  </div>
  <div class="center">
    <header>
      <h1>Unpong</h1>
    </header>

    <div class="score-container">
      <div class="score-card team0">0</div>
      <div class="score-card team1">0</div>
    </div>

  </div>
  <div class="right" data-player="1">
    <header>
      <h1>Team Blue</h1>
      <img src="img/steph.jpg" alt=""/>
      <h2>Steph</h2>
    </header>

  </div>
</div>

<script src="https://cdn.firebase.com/js/client/1.1.2/firebase.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>
  var rootRef = new Firebase("https://unpong.firebaseio.com");
  var playerRef = new Firebase("https://unpong.firebaseio.com/player");
  var activeGameRef = new Firebase("https://unpong.firebaseio.com/liveGame");
  var activeGameScoreRef = new Firebase("https://unpong.firebaseio.com/liveGame/score");

//  $('#save').click(function(){
//    playerName = $('#player-name').val();
//    rootRef.child("player").push({
//      player: playerName
//    });
//  });
//  playerRef.on("child_added",function(snapshot){
//    data = snapshot.val();
//    $('#result span').append(data.player);
//  });

  $('.left, .right').click(function(){
    self = $(this);
    self.addClass('pressed');
    setTimeout(function(){
      self.removeClass('pressed');
    }, 200);
    console.log('blah');
    console.log(self.attr('class'));
    if(self.attr('data-player') === "0"){
      checkScore(0);
    }else if(self.attr('data-player') === "1"){
      checkScore(1);
    }
  });

  var checkScore = function(side){
    activeGameScoreRef.once("value", function(snapshot) {
        setScore(side, snapshot.val());
      }, function (errorObject) {
        console.log("The read failed: " + errorObject.code);
      });
  };

  var setScore = function(side, currentScore){
    if(side === 0){
      newScore = currentScore.team0 + 1;
      activeGameScoreRef.update({team0:newScore});
    }else if(side === 1){
      newScore = currentScore.team1 + 1;
      activeGameScoreRef.update({team1:newScore});
    }
  };

  activeGameScoreRef.on('value', function(snapshot){
    $('.score-card.team0').text(snapshot.val().team0);
    $('.score-card.team1').text(snapshot.val().team1);
  });

</script>
</body>
</html>